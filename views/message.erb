<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="<%= url('/message.css') %>">
  <title>Read my mind, literally</title>
</head>
<body>
  <div class="container">
    <a href="/write-my-mind" class="hidden-button">Write a new message</a>
    <div class="message">
      <p class="verse-1">"<%= @message.verse_1 %></p>
      <p class="verse-2"><%= @message.verse_2 %>"</p>
    </div>
    <div class="footer">
      <p>An attempt to throw the weight of tough days in some poetic ways. More intimate code-art relationships on <a href="https://www.yannklein.me">my portfolio</a>.</p>
    </div>
  </div>
  <script>
    // Code for typed message

    // Select the different elements
    const messageElmt = document.querySelector(".message");
    const verse1Elmt = document.querySelector(".verse-1");
    const verse2Elmt = document.querySelector(".verse-2");

    // Store message from DB
    const verse1 = "\"<%= @message.verse_1 %>";
    const verse2 = "<%= @message.verse_2 %>\"";

    // Keep message element height and then remove the text inside each verse
    const fullMessageHeight = messageElmt.offsetHeight;
    verse1Elmt.innerHTML = "";
    verse2Elmt.innerHTML = "";
    messageElmt.style.opacity = 1;

    // *0.14 is a magic number, the message height before/after loading deosn't match for some reasons..
    messageElmt.style.height = `${fullMessageHeight + fullMessageHeight*0.14}px`;
    console.log(fullMessageHeight, messageElmt.offsetHeight);

    // Rewrite the verse with a typing effect
    verse1.split('').forEach((letter, index) => {
      setTimeout(() => {
        verse1Elmt.innerHTML = `${verse1Elmt.innerHTML}${letter}`;
      }, 50 * index);
    });
    verse2.split('').forEach((letter, index) => {
      setTimeout(() => {
        verse2Elmt.innerHTML = `${verse2Elmt.innerHTML}${letter}`;
      }, 3000 + 50 * index);
    });

    // Adapt VH for mobiles
    let vh = window.innerHeight * 0.01;
    document.documentElement.style.setProperty('--vh', `${vh}px`);

  </script>
</body>
</html>
